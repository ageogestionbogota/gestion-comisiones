<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión Los Olivos</title>
    <style>
        :root { --olivos: #005aab; --fondo: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--fondo); padding: 15px; display: flex; justify-content: center; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); width: 100%; max-width: 750px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full { grid-column: span 2; }
        label { display: block; font-weight: bold; font-size: 12px; margin-bottom: 5px; color: #555; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        input[readonly] { background: #eee; font-weight: bold; color: var(--olivos); }
        .section-title { grid-column: span 2; background: var(--olivos); color: white; padding: 8px; border-radius: 4px; font-size: 14px; margin-top: 10px; }
        button { background: #28a745; color: white; border: none; padding: 15px; border-radius: 6px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } .full { grid-column: span 1; } }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align:center; color:var(--olivos)">Gestión de Comisiones</h2>
    <form id="gestioForm">
        <div class="grid">
            <div class="section-title">DATOS DEL ASESOR</div>
            <div>
                <label>Usuario (Nombre)</label>
                <input type="text" name="usuario" required>
            </div>
            <div>
                <label>Código Usuario</label>
                <input type="text" name="codigo_usuario" required>
            </div>

            <div class="section-title">DATOS DE LA CUENTA</div>
            <div class="full">
                <label>Cuenta (Empresa) - Escriba para filtrar</label>
                <input type="text" name="cuenta" id="busquedaEmpresa" list="listaEmpresas" placeholder="Escriba nombre de la empresa..." autocomplete="off" required>
                <datalist id="listaEmpresas"></datalist>
            </div>
            <div>
                <label>NIT (Automático)</label>
                <input type="text" name="nit" id="resNIT" readonly>
            </div>
            <div>
                <label>Código de Cuenta (Automático)</label>
                <input type="text" name="codigo_cuenta" id="resCodigo" readonly>
            </div>
            <div>
                <label>Zona</label>
                <input type="text" name="zona">
            </div>
            <div>
                <label>Duración</label>
                <input type="text" name="duracion" placeholder="00:00:00">
            </div>

            <div class="section-title">DETALLES DE ACTIVIDAD</div>
            <div>
                <label>Actividad</label>
                <select name="actividad">
                    <option value="CAMPAÑA">CAMPAÑA</option>
                    <option value="RENOVACIÓN">RENOVACIÓN</option>
                    <option value="VISITA">VISITA</option>
                </select>
            </div>
            <div>
                <label>Nombre Contacto</label>
                <input type="text" name="nombre_contacto">
            </div>
            <div class="full">
                <label>Objetivo</label>
                <input type="text" name="objetivo">
            </div>

            <div class="section-title">RESULTADOS</div>
            <div><label>Afiliaciones</label><input type="number" name="afiliaciones" value="0"></div>
            <div><label>Act. Con Ficha</label><input type="number" name="actualizaciones_con" value="0"></div>

            <div class="full">
                <label>Observaciones</label>
                <textarea name="observaciones" rows="3"></textarea>
            </div>
        </div>
        <button type="submit" id="btnEnviar">Guardar Registro</button>
    </form>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/a/macros/losolivos.co/s/AKfycbweKYtcxAgRpe3l1XksY69ws2gM96AcCOSgFzdl_Z1UVIFgeTSBwenYk6IqrmIuBPXX/exec"; // <-- PEGA TU URL AQUÍ
    let cacheEmpresas = [];

    // LÓGICA DE BÚSQUEDA "WHERE LIKE"
    const inputBusqueda = document.getElementById('busquedaEmpresa');
    inputBusqueda.addEventListener('input', function() {
        const query = this.value;
        if (query.length >= 3) {
            fetch(`${SCRIPT_URL}?q=${encodeURIComponent(query)}`)
                .then(res => res.json())
                .then(data => {
                    cacheEmpresas = data;
                    const dl = document.getElementById('listaEmpresas');
                    dl.innerHTML = '';
                    data.forEach(e => {
                        let opt = document.createElement('option');
                        opt.value = e.nombre;
                        dl.appendChild(opt);
                    });
                });
        }
        
        // Autocompletar NIT y Código al seleccionar
        const match = cacheEmpresas.find(e => e.nombre === query);
        if (match) {
            document.getElementById('resNIT').value = match.nit;
            document.getElementById('resCodigo').value = match.codigo;
        }
    });

    // ENVÍO DE FORMULARIO
    document.getElementById('gestioForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnEnviar');
        btn.disabled = true; btn.innerText = "Enviando...";

        fetch(SCRIPT_URL, { method: 'POST', body: new FormData(this) })
            .then(() => {
                alert("¡Guardado correctamente!");
                this.reset();
                btn.disabled = false; btn.innerText = "Guardar Registro";
            });
    });
</script>
</body>
</html>
